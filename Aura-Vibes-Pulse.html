<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aura Vibes Pulse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ====================================
        SETTINGS PANEL - RHYTHM CONTROLLER
        ==================================== */
        .settings-panel {
            position: fixed;
            z-index: 50;
            width: 280px;
            background-color: #1A1A1A;
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid #2A2A2A;
            display: flex;
            flex-direction: column;
        }

        .settings-panel-titlebar {
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #2A2A2A;
            background-color: #0F0F0F;
            color: #FFFFFF;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            cursor: grab;
            user-select: none;
        }

        .settings-panel-titlebar:active {
            cursor: grabbing;
        }

        .settings-panel-title {
            font-family: sans-serif;
            font-weight: 500;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .settings-panel-minimize-btn {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #2A2A2A;
            border: 1px solid rgba(224, 224, 224, 0.13);
            transition: background-color 0.2s;
            cursor: pointer;
        }

        .settings-panel-minimize-btn:hover {
            background-color: rgba(42, 42, 42, 0.8);
        }

        .settings-panel-body {
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
        }

        .settings-section-header {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 8px;
            font-weight: 600;
            color: #9CA3AF;
        }

        .rhythm-buttons-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .rhythm-btn {
            position: relative;
            padding: 10px 8px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            border-radius: 4px;
            transition: all 0.2s;
            background-color: #2A2A2A;
            color: #FFFFFF;
            border: 1px solid #2A2A2A;
            cursor: pointer;
        }

        .rhythm-btn:hover {
            background-color: rgba(42, 42, 42, 0.8);
        }

        .rhythm-btn.active {
            background-color: #3A3A3A;
            border-color: #4A4A4A;
        }

        .vst-fader-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            width: 100%;
            margin-bottom: 12px;
        }

        .vst-fader-label {
            text-align: left;
            font-size: 10px;
            text-transform: uppercase;
            margin-bottom: 6px;
            letter-spacing: 0.05em;
            color: #9CA3AF;
        }

        .vst-fader-track-area {
            position: relative;
            width: 100%;
            height: 32px;
            display: flex;
            align-items: center;
            padding-left: 14px;
            padding-right: 14px;
        }

        .vst-fader-track {
            position: absolute;
            left: 0;
            right: 0;
            height: 6px;
            background-color: #2A2A2A;
            border-radius: 3px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.8),
                        inset 0 -1px 1px rgba(255, 255, 255, 0.05);
        }

        .vst-fader-progress {
            height: 100%;
            border-radius: 2px;
            background-color: #505050;
            box-shadow: 0 0 5px rgba(80, 80, 80, 0.63);
        }

        .vst-fader-input {
            position: absolute;
            left: 0;
            right: 0;
            width: 100%;
            height: 100%;
            appearance: none;
            cursor: pointer;
            background: transparent;
            z-index: 10;
        }

        .vst-fader-input::-webkit-slider-thumb {
            appearance: none;
            cursor: pointer;
            box-sizing: border-box;
            background: linear-gradient(90deg, #4a4a4a 0 9px, #444 0px, #000 7px, #fff 12px, #333 10px 40px, #444 0px, #2a2a2a 25px);
            border: 1px solid #111;
            border-radius: 3px;
            width: 25px;
            height: 30px;
            position: relative;
            box-shadow: 0 2px 10px #00000080, inset 0 0 2px #ffffff80;
        }

        .vst-fader-input::-moz-range-thumb {
            width: 28px;
            height: 56px;
            cursor: pointer;
            background: linear-gradient(to right, #4a4a4a 0px, #4a4a4a 9px, #444444 10px, #000 11px, #ffffff 13px, #333333 15px, #444444 16px, #2a2a2a 40px);
            box-shadow: 0 2px 10px 0px rgba(0,0,0,0.5), 0 0px 2px 0px rgba(255,255,255,0.5) inset;
            box-sizing: border-box;
            border: 1px solid #111;
            border-radius: 2px;
        }

        .vst-fader-input::-webkit-slider-runnable-track {
            background: transparent;
            border: none;
        }

        .vst-fader-input::-moz-range-track {
            background: transparent;
            border: none;
        }

        .vst-fader-thumb-line {
            position: absolute;
            width: 16px;
            height: 2px;
            background-color: rgba(0, 0, 0, 0.6);
            pointer-events: none;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 11;
        }

        .settings-checkbox {
            width: 14px;
            height: 14px;
            accent-color: #505050;
            cursor: pointer;
        }

        .settings-checkbox-label {
            margin-left: 8px;
            font-size: 10px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #9CA3AF;
        }

        .settings-color-picker-label {
            font-size: 9px;
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #9CA3AF;
        }

        .settings-color-picker {
            width: 100%;
            height: 32px;
            padding: 0;
            border: none;
            cursor: pointer;
            border-radius: 6px;
            background-color: #2A2A2A;
        }

        .settings-action-buttons {
            margin-top: 8px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .settings-action-btn {
            position: relative;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            border-radius: 6px;
            transition: all 0.2s;
            background-color: #2A2A2A;
            color: #FFFFFF;
            border: 1px solid #2A2A2A;
            cursor: pointer;
        }

        .settings-action-btn:hover {
            background-color: rgba(42, 42, 42, 0.9);
        }

        .settings-divider {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #2A2A2A;
        }

        /* ====================================
        FOOTER COMPONENT STYLES
        ==================================== */
        .footer-link {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 9999px;
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .footer-link:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 1);
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1);
        }

        .footer-link .arrow-icon {
            transition: transform 0.3s ease;
        }

        .footer-link:hover .arrow-icon {
            transform: translateX(4px);
        }

        /* Mobile responsive */
        @media (max-width: 640px) {
            .footer-link {
                bottom: 16px;
                padding: 0.4rem 0.75rem;
                font-size: 0.75rem;
                max-width: calc(100% - 32px);
            }
            
            .footer-link span {
                max-width: 200px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
        }

        /* Minimized panel state */
        .settings-panel.minimized .settings-panel-body {
            display: none;
        }
    </style>
</head>
<body class="bg-[#0F0F0F]">
    <div class="fixed inset-0 bg-[#0F0F0F] z-0">
        <!-- Settings Panel -->
        <div class="settings-panel" id="settingsPanel" style="top: 20px; left: 20px;">
            <div class="settings-panel-titlebar" id="titleBar">
                <span class="settings-panel-title">Rhythm Controller</span>
                <button class="settings-panel-minimize-btn" id="minimizeBtn">
                    <svg viewBox="0 0 16 16" fill="#505050" class="w-3 h-3" id="minimizeIcon">
                        <path d="M5 2H1v13h10v-4h4V5H9V1h-4zm7 4v7H2V3h3V2h7v3h-3v4z"/>
                    </svg>
                </button>
            </div>
            
            <div class="settings-panel-body" id="panelBody">
                <!-- Pulse Style -->
                <div>
                    <h3 class="settings-section-header">Pulse Style</h3>
                    <div class="rhythm-buttons-grid">
                        <button class="rhythm-btn active" data-rhythm="techno">R1</button>
                        <button class="rhythm-btn" data-rhythm="hiphop">R2</button>
                        <button class="rhythm-btn" data-rhythm="lofi">R3</button>
                        <button class="rhythm-btn" data-rhythm="rock">R4</button>
                    </div>
                </div>

                <!-- Light Dynamics -->
                <div>
                    <h3 class="settings-section-header">Light Dynamics</h3>
                    
                    <div class="vst-fader-container">
                        <div class="vst-fader-label">Pulse Amplitude (1.00)</div>
                        <div class="vst-fader-track-area">
                            <div class="vst-fader-track">
                                <div class="vst-fader-progress" style="width: 100%;"></div>
                            </div>
                            <input type="range" min="0.1" max="1.0" step="0.05" value="1.0" class="vst-fader-input" id="amplitudeSlider">
                        </div>
                    </div>

                    <div class="vst-fader-container">
                        <div class="vst-fader-label">Radius (0.88)</div>
                        <div class="vst-fader-track-area">
                            <div class="vst-fader-track">
                                <div class="vst-fader-progress" style="width: 88%;"></div>
                            </div>
                            <input type="range" min="0.4" max="1.5" step="0.05" value="0.875" class="vst-fader-input" id="radiusSlider">
                        </div>
                    </div>

                    <div class="vst-fader-container">
                        <div class="vst-fader-label">Concentration (0.03)</div>
                        <div class="vst-fader-track-area">
                            <div class="vst-fader-track">
                                <div class="vst-fader-progress" style="width: 4%;"></div>
                            </div>
                            <input type="range" min="0.01" max="0.5" step="0.01" value="0.03" class="vst-fader-input" id="concentrationSlider">
                        </div>
                    </div>

                    <div class="vst-fader-container">
                        <div class="vst-fader-label">Persistence (0.020)</div>
                        <div class="vst-fader-track-area">
                            <div class="vst-fader-track">
                                <div class="vst-fader-progress" style="width: 16%;"></div>
                            </div>
                            <input type="range" min="0.005" max="0.1" step="0.005" value="0.02" class="vst-fader-input" id="persistenceSlider">
                        </div>
                    </div>

                    <div class="vst-fader-container">
                        <div class="vst-fader-label">Color Speed (64)</div>
                        <div class="vst-fader-track-area">
                            <div class="vst-fader-track">
                                <div class="vst-fader-progress" style="width: 20%;"></div>
                            </div>
                            <input type="range" min="30" max="200" step="10" value="64" class="vst-fader-input" id="colorSpeedSlider">
                        </div>
                    </div>
                </div>

                <!-- Grid & Color -->
                <div>
                    <h3 class="settings-section-header">Grid & Color</h3>
                    
                    <div class="vst-fader-container">
                        <div class="vst-fader-label">Grid Density (1.00)</div>
                        <div class="vst-fader-track-area">
                            <div class="vst-fader-track">
                                <div class="vst-fader-progress" style="width: 50%;"></div>
                            </div>
                            <input type="range" min="0.5" max="1.5" step="0.1" value="1.0" class="vst-fader-input" id="gridDensitySlider">
                        </div>
                    </div>

                    <div class="settings-divider">
                        <div class="flex items-center mb-2">
                            <input id="color-cycle" type="checkbox" class="settings-checkbox" checked>
                            <label for="color-cycle" class="settings-checkbox-label">Enable Color Cycle</label>
                        </div>
                        <div class="mt-2" id="staticColorContainer" style="display: none;">
                            <label class="settings-color-picker-label">Static Color</label>
                            <input type="color" value="#505050" class="settings-color-picker" id="staticColorPicker">
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="settings-action-buttons">
                    <button class="settings-action-btn" id="resetBtn">Reset</button>
                    <button class="settings-action-btn" id="applyBtn">Apply</button>
                </div>
            </div>
        </div>

        <!-- Canvas Elements -->
        <canvas class="fixed inset-0 w-full h-full z-10" id="canvasLight"></canvas>
        <canvas class="fixed inset-0 w-full h-full z-20" id="canvasGrid"></canvas>

        <!-- Footer Link -->
        <a href="https://bigbangsocial.com/" target="_blank" rel="noopener noreferrer" class="footer-link">
            <span>Let's add this to your brand: Contact us</span>
            <svg class="arrow-icon w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
        </a>
    </div>

    <script>
        // =======================================================
        // --- CONSTANTS ---
        // =======================================================
        const PRIMARY_GRAY = '#505050';
        const DEEP_BLACK = '#0F0F0F';
        const PANEL_GRAY = '#1A1A1A';
        const TRACK_GRAY = '#2A2A2A';
        const HIGHLIGHT_WHITE = '#E0E0E0';
        const TEXT_COLOR = '#9CA3AF';

        const PULSE_RHYTHMS = {
            "techno": { base: 0.2, frequency: 0.15, decay: 0.9, amplitude: 0.8, chaos: false },
            "hiphop": { base: 0.1, frequency: 0.05, decay: 0.85, amplitude: 1.0, chaos: false },
            "lofi": { base: 0.4, frequency: 0.02, decay: 0.95, amplitude: 0.5, chaos: false },
            "rock": { base: 0.05, frequency: 0.1, decay: 0.7, amplitude: 1.2, chaos: false },
            "ambient": { base: 0.0, frequency: 0.0, decay: 0, chaos: true, amplitude: 1.0 }
        };

        const DEFAULT_SETTINGS = {
            useColorCycle: true,
            staticColor: PRIMARY_GRAY,
            colorTransitionSpeed: 64,
            pulseAmplitude: 1.0,
            lightRadiusMultiplier: 0.875,
            lightConcentration: 0.03,
            persistenceFactor: 0.02,
            gridScaleFactor: 1.0,
        };

        const NEON_PALETTE = ["#FF006E", "#8338EC", "#3A86FF", "#06FFA5", "#FFBE0B", "#FB5607"];

        // =======================================================
        // --- STATE ---
        // =======================================================
        let currentRhythm = "techno";
        let settings = { ...DEFAULT_SETTINGS };
        let currentPulseIntensity = 0.0;
        let isMinimized = false;
        let panelPosition = { x: 20, y: 20 };
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };

        // =======================================================
        // --- CANVAS SETUP ---
        // =======================================================
        const canvasLight = document.getElementById('canvasLight');
        const canvasGrid = document.getElementById('canvasGrid');
        const ctxLight = canvasLight.getContext('2d');
        const ctxGrid = canvasGrid.getContext('2d');

        let width, height, minDim;
        let grid = null;
        let source = null;
        let t = 0;
        let request_id = null;
        let csi = 0;

        const { cos, sin, sqrt, PI, min, random } = Math;

        // =======================================================
        // --- GRID CLASSES ---
        // =======================================================
        class GridItem {
            constructor(x = 0, y = 0) {
                this.x = x;
                this.y = y;
                this.points = { hex: [], hl: [] };
                this.init();
            }

            init() {
                const SCALE = settings.gridScaleFactor;
                const HEX_CRAD = 32 * SCALE;
                const HEX_HLW = 2 * SCALE;
                const ba = PI / 3;
                const ri = HEX_CRAD - 0.5 * HEX_HLW;

                for (let i = 0; i < 6; i++) {
                    const a = i * ba;
                    const x = this.x + HEX_CRAD * cos(a);
                    const y = this.y + HEX_CRAD * sin(a);
                    this.points.hex.push({ x, y });
                    if (i > 2) {
                        const hlx = this.x + ri * cos(a);
                        const hly = this.y + ri * sin(a);
                        this.points.hl.push({ x: hlx, y: hly });
                    }
                }
            }

            draw(ct) {
                for (let i = 0; i < 6; i++) {
                    if (i === 0) {
                        ct.moveTo(this.points.hex[i].x, this.points.hex[i].y);
                    } else {
                        ct.lineTo(this.points.hex[i].x, this.points.hex[i].y);
                    }
                }
            }

            highlight(ct) {
                for (let i = 0; i < 3; i++) {
                    if (i === 0) {
                        ct.moveTo(this.points.hl[i].x, this.points.hl[i].y);
                    } else {
                        ct.lineTo(this.points.hl[i].x, this.points.hl[i].y);
                    }
                }
            }
        }

        class Grid {
            constructor(rows = 16, cols = 16) {
                this.cols = cols;
                this.rows = rows;
                this.items = [];
                this.n = 0;
                this.init();
            }

            init() {
                const SCALE = settings.gridScaleFactor;
                const HEX_CRAD = 32 * SCALE;
                const HEX_GAP = 4 * SCALE;
                const unit_x = 3 * HEX_CRAD + HEX_GAP * sqrt(3);
                const unit_y = HEX_CRAD * sqrt(3) * 0.5 + 0.5 * HEX_GAP;
                const off_x = 1.5 * HEX_CRAD + HEX_GAP * sqrt(3) * 0.5;

                for (let row = 0; row < this.rows; row++) {
                    const y = row * unit_y;
                    for (let col = 0; col < this.cols; col++) {
                        const x = (row % 2 === 0 ? 0 : off_x) + col * unit_x;
                        this.items.push(new GridItem(x, y));
                    }
                }
                this.n = this.items.length;
            }

            draw(ct) {
                const SCALE = settings.gridScaleFactor;
                const HEX_CRAD = 32 * SCALE;
                const HEX_BG = DEEP_BLACK;
                const HEX_HL = PANEL_GRAY;

                ct.fillStyle = HEX_BG;
                ct.beginPath();
                for (let i = 0; i < this.n; i++) {
                    this.items[i].draw(ct);
                }
                ct.closePath();
                ct.fill();

                ct.strokeStyle = HEX_HL;
                ct.beginPath();
                for (let i = 0; i < this.n; i++) {
                    this.items[i].highlight(ct);
                }
                ct.closePath();
                ct.stroke();
            }
        }

        // =======================================================
        // --- ANIMATION ---
        // =======================================================
        function init() {
            const style = getComputedStyle(canvasLight);
            width = parseInt(style.width) || window.innerWidth;
            height = parseInt(style.height) || window.innerHeight;
            minDim = 0.75 * min(width, height);

            const SCALE = settings.gridScaleFactor;
            const HEX_CRAD = 32 * SCALE;
            const HEX_GAP = 4 * SCALE;
            const unit_x = 3 * HEX_CRAD + HEX_GAP * sqrt(3);
            const unit_y = HEX_CRAD * sqrt(3) * 0.5 + 0.5 * HEX_GAP;

            const rows = Math.floor(height / unit_y) + 2;
            const cols = Math.floor(width / unit_x) + 2;

            canvasLight.width = width;
            canvasLight.height = height;
            canvasGrid.width = width;
            canvasGrid.height = height;

            grid = new Grid(rows, cols);
            grid.draw(ctxGrid);

            if (!source) {
                source = { x: Math.floor(width / 2), y: Math.floor(height / 2) };
            }

            neon();
        }

        function neon() {
            if (!source) return;

            const rhythmConfig = PULSE_RHYTHMS[currentRhythm];
            let pulseValue;

            if (rhythmConfig.chaos) {
                pulseValue = sin(7 * t * (1 / settings.colorTransitionSpeed)) * 
                            cos(5 * t * (1 / settings.colorTransitionSpeed)) * 
                            sin(3 * t * (1 / settings.colorTransitionSpeed));
            } else {
                currentPulseIntensity *= rhythmConfig.decay;
                if (random() < rhythmConfig.frequency && currentPulseIntensity < 0.2) {
                    currentPulseIntensity = random() * rhythmConfig.amplitude;
                }
                pulseValue = Math.min(1.0, currentPulseIntensity + rhythmConfig.base);
            }

            // Color logic
            let rgb_str;
            if (!settings.useColorCycle) {
                rgb_str = settings.staticColor;
            } else {
                const T_SWITCH = settings.colorTransitionSpeed;
                const f = 1 / T_SWITCH;
                const k = (t % T_SWITCH) * f;
                const nwp = NEON_PALETTE.length;
                
                const parseColor = (hex) => {
                    const num = parseInt(hex.replace("#", ""), 16);
                    return {
                        r: (num >> 16) & 0xff,
                        g: (num >> 8) & 0xff,
                        b: num & 0xff
                    };
                };

                const wp = NEON_PALETTE.map(parseColor);
                const rgb = {
                    r: Math.floor(wp[csi].r * (1 - k) + wp[(csi + 1) % nwp].r * k),
                    g: Math.floor(wp[csi].g * (1 - k) + wp[(csi + 1) % nwp].g * k),
                    b: Math.floor(wp[csi].b * (1 - k) + wp[(csi + 1) % nwp].b * k)
                };
                rgb_str = `rgb(${rgb.r},${rgb.g},${rgb.b})`;
            }

            // Apply pulse
            const finalPulseAmplitude = pulseValue * settings.pulseAmplitude;
            const stp = 0.5 - 0.5 * finalPulseAmplitude;
            const customRadius = settings.lightRadiusMultiplier * minDim;

            const light = ctxLight.createRadialGradient(
                source.x, source.y, 0,
                source.x, source.y, customRadius
            );

            const concentrationString = `rgba(0,0,0,${settings.lightConcentration.toFixed(2)})`;
            light.addColorStop(0, rgb_str);
            light.addColorStop(stp, concentrationString);

            const fadeOutString = `rgba(0,0,0,${settings.persistenceFactor.toFixed(3)})`;
            fillBackground(fadeOutString);
            fillBackground(light);

            t++;

            if (settings.useColorCycle && t % settings.colorTransitionSpeed === 0) {
                csi++;
                if (csi === NEON_PALETTE.length) {
                    csi = 0;
                    t = 0;
                }
            }

            request_id = requestAnimationFrame(neon);
        }

        function fillBackground(bg_fill) {
            ctxLight.fillStyle = bg_fill;
            ctxLight.beginPath();
            ctxLight.rect(0, 0, width, height);
            ctxLight.closePath();
            ctxLight.fill();
        }

        // =======================================================
        // --- EVENT HANDLERS ---
        // =======================================================
        function handleResize() {
            if (request_id) {
                cancelAnimationFrame(request_id);
            }
            init();
        }

        function handleMouseMove(e) {
            source = { x: e.clientX, y: e.clientY };
        }

        // Panel dragging
        const titleBar = document.getElementById('titleBar');
        const settingsPanel = document.getElementById('settingsPanel');

        titleBar.addEventListener('mousedown', (e) => {
            isDragging = true;
            dragOffset = {
                x: e.clientX - panelPosition.x,
                y: e.clientY - panelPosition.y
            };
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            
            let newX = e.clientX - dragOffset.x;
            let newY = e.clientY - dragOffset.y;
            
            newX = Math.max(0, Math.min(newX, window.innerWidth - settingsPanel.offsetWidth));
            newY = Math.max(0, Math.min(newY, window.innerHeight - settingsPanel.offsetHeight));
            
            panelPosition = { x: newX, y: newY };
            settingsPanel.style.left = `${newX}px`;
            settingsPanel.style.top = `${newY}px`;
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
        });

        // Minimize button
        const minimizeBtn = document.getElementById('minimizeBtn');
        const minimizeIcon = document.getElementById('minimizeIcon');
        const panelBody = document.getElementById('panelBody');

        minimizeBtn.addEventListener('click', () => {
            isMinimized = !isMinimized;
            if (isMinimized) {
                panelBody.style.display = 'none';
                minimizeIcon.innerHTML = '<path d="M5 2H1v13h10v-4h4V5H9V1h-4zm7 4v7H2V3h3V2h7v3h-3v4z"/>';
            } else {
                panelBody.style.display = 'flex';
                minimizeIcon.innerHTML = '<line x1="2" y1="18" x2="18" y2="18" stroke="#505050" stroke-width="4" stroke-linecap="round"/>';
            }
        });

        // Rhythm buttons
        document.querySelectorAll('.rhythm-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.rhythm-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentRhythm = btn.dataset.rhythm;
            });
        });

        // Fader sliders
        function updateFader(slider, settingKey, labelPrefix) {
            slider.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                settings[settingKey] = value;
                const progress = slider.parentElement.querySelector('.vst-fader-progress');
                const percentage = ((value - slider.min) / (slider.max - slider.min)) * 100;
                progress.style.width = `${percentage}%`;
                slider.parentElement.previousElementSibling.textContent = 
                    `${labelPrefix} (${value.toFixed(settingKey === 'persistenceFactor' || settingKey === 'lightConcentration' ? 3 : 2)})`;
            });
        }

        updateFader(document.getElementById('amplitudeSlider'), 'pulseAmplitude', 'Pulse Amplitude');
        updateFader(document.getElementById('radiusSlider'), 'lightRadiusMultiplier', 'Radius');
        updateFader(document.getElementById('concentrationSlider'), 'lightConcentration', 'Concentration');
        updateFader(document.getElementById('persistenceSlider'), 'persistenceFactor', 'Persistence');
        updateFader(document.getElementById('colorSpeedSlider'), 'colorTransitionSpeed', 'Color Speed');
        updateFader(document.getElementById('gridDensitySlider'), 'gridScaleFactor', 'Grid Density');

        // Color cycle checkbox
        const colorCycleCheckbox = document.getElementById('color-cycle');
        const staticColorContainer = document.getElementById('staticColorContainer');

        colorCycleCheckbox.addEventListener('change', (e) => {
            settings.useColorCycle = e.target.checked;
            staticColorContainer.style.display = e.target.checked ? 'none' : 'block';
        });

        // Static color picker
        document.getElementById('staticColorPicker').addEventListener('input', (e) => {
            settings.staticColor = e.target.value;
        });

        // Reset button
        document.getElementById('resetBtn').addEventListener('click', () => {
            settings = { ...DEFAULT_SETTINGS };
            currentRhythm = "techno";
            
            document.querySelectorAll('.rhythm-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('[data-rhythm="techno"]').classList.add('active');
            
            colorCycleCheckbox.checked = settings.useColorCycle;
            staticColorContainer.style.display = settings.useColorCycle ? 'none' : 'block';
            
            // Reset all sliders
            document.getElementById('amplitudeSlider').value = settings.pulseAmplitude;
            document.getElementById('radiusSlider').value = settings.lightRadiusMultiplier;
            document.getElementById('concentrationSlider').value = settings.lightConcentration;
            document.getElementById('persistenceSlider').value = settings.persistenceFactor;
            document.getElementById('colorSpeedSlider').value = settings.colorTransitionSpeed;
            document.getElementById('gridDensitySlider').value = settings.gridScaleFactor;
            document.getElementById('staticColorPicker').value = settings.staticColor;
            
            // Update all fader labels and progress
            const sliders = [
                { id: 'amplitudeSlider', key: 'pulseAmplitude', label: 'Pulse Amplitude', decimals: 2 },
                { id: 'radiusSlider', key: 'lightRadiusMultiplier', label: 'Radius', decimals: 2 },
                { id: 'concentrationSlider', key: 'lightConcentration', label: 'Concentration', decimals: 2 },
                { id: 'persistenceSlider', key: 'persistenceFactor', label: 'Persistence', decimals: 3 },
                { id: 'colorSpeedSlider', key: 'colorTransitionSpeed', label: 'Color Speed', decimals: 0 },
                { id: 'gridDensitySlider', key: 'gridScaleFactor', label: 'Grid Density', decimals: 2 }
            ];
            
            sliders.forEach(({ id, key, label, decimals }) => {
                const slider = document.getElementById(id);
                const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
                slider.parentElement.querySelector('.vst-fader-progress').style.width = `${percentage}%`;
                slider.parentElement.previousElementSibling.textContent = `${label} (${parseFloat(slider.value).toFixed(decimals)})`;
            });
        });

        // Apply button (visual feedback only)
        document.getElementById('applyBtn').addEventListener('click', () => {
            const btn = document.getElementById('applyBtn');
            const originalText = btn.textContent;
            btn.textContent = 'Applied!';
            btn.style.backgroundColor = '#3A3A3A';
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.backgroundColor = '#2A2A2A';
            }, 1000);
        });

        // Initialize
        window.addEventListener('resize', handleResize);
        window.addEventListener('mousemove', handleMouseMove);
        init();
    </script>
</body>
</html>

